# Бот для онлайн-квеста от точки movement'а на ДОД'e Вышки

### Со стороны пользователя

- Заходишь в бота тг
- Получаешь приветственное сообщение с командой начала квеста
- Пишешь команду старта квеста _ИЛИ_ тыкаешь кнопку под приветственным сообщением для начала квеста
- Получаешь сообщение и N кнопок, каждая из которых ведёт к другому такому же сообщению, _ПЛЮС_ одна кнопка для остановки квеста

### Со стороны программы

Сценарий будет записан в гугл таблице с минимум двумя листами (пример есть в ссылках в конце):

- Лист «script»: 
Название текста — сам текст сообщения

- Лист «кнопки»:
Название текста, под которым закрепить эту кнопку — текст, который должен быть написан на кнопке — название текста, который должен отправиться после нажатия на эту кнопку

### Со стороны разработчиков

#### Нужно:

1. Написать обертку под бд, за шаблонам обращаться к @gkar1na (либо предложить вариант лучше)

2. Написать функцию, которая парсит 2 столбца одного листа и 3 столбца второго листа в бдшку. Функция может просто дроппнуть таблицу сценариев и кнопок к ним, после чего загрузить с нуля, но по-хорошему написать именно обновление (в этом случае можно хранить дату последнего обновления записи в бд) (БЛОК п.1)

3. Написать аутентификацию пользователя. Пока нас интересует только тг айди. Приветственное сообщение должно содержать пока одну кнопку — начала квеста. По активному токену из бд пользователь добавляется в админы, а токен деактивируется (БЛОК п.1-2)

4. Написать механику квеста (за готовой реализацией к @gkar1na либо предложить вариант лучше). Каждый текст имеет свои N кнопок и кнопку выхода с квеста. В бд запоминается последний шаг квеста, чтобы в случае продолжения квеста он реально продолжился, а не начался заново. Если пользователь тыкает кнопку, то предыдущая клавиатура должна быть удалена (вроде, это возможно, точно не помню). Если пользователь тыкает кнопку остановки квеста, то ему высылается сообщение с приглашением начать заново или продолжить с места остановки (эти кнопки НЕ удаляются) (БЛОК п.1-3)

5. Написать функции админа:
   — /update <link-to-spreadsheet> — берет ссылку и обновляет бд (БЛОК от п.1-2)
   — /new_token <OPTION token> — добавляет переданный токен или создаётся токен по uuid
   — /get_token — выдаёт активный токен из бд (если свободных токенов нет, то предлагает создать новый)

6. Протестить всё на мувменте **10-11 числа** и пофиксить траблы к доду ( на вопрос «как успеть» ответ — чудом...)

#### Необходимые для разработки ссылки:

- [Схема бд](https://dbdiagram.io/d/6224e70c54f9ad109a6a7405)

- [Пример сценария](https://docs.google.com/spreadsheets/d/1LcVHqbpY6iQ7GT6bo2P_cYnRZxjs4O1CuMWgicZ6UPU/edit#gid=543917617)
